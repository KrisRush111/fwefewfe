<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Игра Змейка</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        snake: '#4ade80',
                        snakeHead: '#16a34a',
                        food: '#ef4444',
                        background: '#0f172a',
                        panel: '#1e293b'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease-in-out infinite;
        }
        
        .snake-game {
            touch-action: none;
        }
        
        #game-canvas {
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .control-button {
            transition: all 0.2s ease;
        }
        
        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .control-button:active {
            transform: translateY(1px);
        }
        
        .mobile-controls {
            display: none;
        }
        
        @media (max-width: 768px) {
            .mobile-controls {
                display: grid;
            }
        }
        
        #score-display {
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 5px rgba(74, 222, 128, 0.7);
        }
        
        .game-over {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(74, 222, 128, 0.5);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 to-indigo-900 min-h-screen flex flex-col items-center justify-center py-8 px-4">
    <div class="max-w-4xl w-full text-center">
    
        
        <div class="flex flex-wrap justify-center gap-8">
            <div class="snake-game relative bg-background rounded-2xl p-1 shadow-2xl">
                <div class="flex justify-between items-center mb-4 py-2 px-4 bg-panel rounded-xl">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-apple-alt text-2xl text-food"></i>
                        <span id="score-display" class="text-2xl font-bold text-white">0</span>
                    </div>
            
                </div>
                
                <canvas id="game-canvas" class="block bg-background border-2 border-panel" width="600" height="400"></canvas>
                
                <div id="game-over" class="absolute inset-0 flex items-center justify-center bg-transparent pointer-events-none opacity-0 transition-all duration-300">
                    <div class="game-over text-white p-8 rounded-2xl text-center max-w-md w-full transform scale-95 transition-transform">
                        <h2 class="text-3xl font-bold text-red-400 mb-4">Игра окончена!</h2>
                        <p class="text-xl mb-2">Ваш счёт: <span id="final-score" class="font-bold text-green-400">0</span></p>
                        <p class="text-amber-300 mb-6">Попробуйте ещё раз!</p>
                        <button id="restart-btn" class="bg-gradient-to-r from-green-500 to-teal-500 text-white font-bold py-3 px-6 rounded-full hover:opacity-90 transition-all">
                            Играть снова
                        </button>
                    </div>
                </div>
                
                <div id="welcome-screen" class="absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm rounded-xl">
                    <div class="text-center p-8 max-w-md">
                        <i class="fas fa-snake text-6xl text-green-500 mb-6 pulse"></i>
                        <h2 class="text-3xl font-bold text-white mb-4">Добро пожаловать в Змейку!</h2>
                        <div class="bg-panel/80 rounded-xl p-6 mb-6 text-left text-indigo-100">
                            <p class="mb-3"><i class="fas fa-mouse-pointer text-green-400 mr-2"></i> Управление: двигайте мышью/пальцем за головой змейки</p>
                            <p class="mb-3"><i class="fas fa-apple-alt text-food mr-2"></i> Собирайте яблоки для увеличения длины</p>
                            <p><i class="fas fa-skull-crossbones text-red-400 mr-2"></i> Избегайте стен и своего хвоста</p>
                        </div>
                        <button id="start-btn" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white font-bold py-4 px-10 rounded-full text-lg transform transition-transform hover:scale-105">
                            Начать игру
                        </button>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Настройки игры
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const welcomeScreen = document.getElementById('welcome-screen');
            const gameOverScreen = document.getElementById('game-over');
            const scoreDisplay = document.getElementById('score-display');
            const finalScoreDisplay = document.getElementById('final-score');
            const highScoresList = document.getElementById('high-scores');
            
            const gridSize = 20;
            const tileCount = canvas.width / gridSize;
            let snake = [];
            let food = { x: 0, y: 0 };
            let direction = 'right';
            let nextDirection = 'right';
            let score = 0;
            let gameSpeed = 150;
            let gameRunning = false;
            let gameLoop;
            
            // Инициализация игры
            function initGame() {
                // Создаем змейку
                snake = [
                    { x: 5, y: 10 },
                    { x: 4, y: 10 },
                    { x: 3, y: 10 }
                ];
                
                // Начальное направление
                direction = 'right';
                nextDirection = 'right';
                
                // Начальные очки
                score = 0;
                updateScore();
                
                // Генерация первой еды
                generateFood();
                
                // Начальная скорость
                gameSpeed = 150;
            }
            
            // Генерация еды в случайном месте
            function generateFood() {
                let newFood;
                let foodOnSnake;
                
                do {
                    foodOnSnake = false;
                    newFood = {
                        x: Math.floor(Math.random() * tileCount),
                        y: Math.floor(Math.random() * tileCount)
                    };
                    
                    // Проверяем, не появилась ли еда на змейке
                    for (let segment of snake) {
                        if (segment.x === newFood.x && segment.y === newFood.y) {
                            foodOnSnake = true;
                            break;
                        }
                    }
                } while (foodOnSnake);
                
                food = newFood;
            }
            
            // Основной игровой цикл
            function runGame() {
                direction = nextDirection;
                
                // Перемещаем голову змейки
                const head = { x: snake[0].x, y: snake[0].y };
                
                switch (direction) {
                    case 'right': head.x++; break;
                    case 'left': head.x--; break;
                    case 'up': head.y--; break;
                    case 'down': head.y++; break;
                }
                
                // Проверка на столкновение со стеной
                if (head.x < 0 || head.y < 0 || head.x >= tileCount || head.y >= tileCount) {
                    gameOver();
                    return;
                }
                
                // Проверка на столкновение с самой собой
                for (let i = 0; i < snake.length; i++) {
                    if (snake[i].x === head.x && snake[i].y === head.y) {
                        gameOver();
                        return;
                    }
                }
                
                // Добавление новой головы
                snake.unshift(head);
                
                // Проверка на съедение яблока
                if (head.x === food.x && head.y === food.y) {
                    // Увеличиваем счет
                    score++;
                    updateScore();
                    
                    // Увеличиваем скорость каждые 3 очка
                    if (score % 3 === 0 && gameSpeed > 70) {
                        gameSpeed -= 10;
                    }
                    
                    // Генерируем новую еду
                    generateFood();
                } else {
                    // Если не съели еду - удаляем хвост
                    snake.pop();
                }
                
                // Отрисовка игры
                drawGame();
            }
            
            // Отрисовка игры
            function drawGame() {
                // Очистка холста
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Отрисовка змейки
                snake.forEach((segment, index) => {
                    if (index === 0) {
                        // Голова змейки
                        ctx.fillStyle = '#16a34a';
                    } else {
                        // Тело змейки
                        ctx.fillStyle = '#4ade80';
                    }
                    
                    ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                    
                    // Добавление градиента
                    const gradient = ctx.createLinearGradient(
                        segment.x * gridSize, 
                        segment.y * gridSize, 
                        (segment.x + 1) * gridSize, 
                        (segment.y + 1) * gridSize
                    );
                    
                    if (index === 0) {
                        gradient.addColorStop(0, '#4ade80');
                        gradient.addColorStop(1, '#16a34a');
                    } else {
                        gradient.addColorStop(0, '#22c55e');
                        gradient.addColorStop(1, '#4ade80');
                    }
                    
                    ctx.fillStyle = gradient;
                    ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                    
                    // Добавление эффекта чешуи
                    if (index !== 0) {
                        ctx.strokeStyle = '#166534';
                        ctx.lineWidth = 0.5;
                        ctx.strokeRect(segment.x * gridSize + 2, segment.y * gridSize + 2, gridSize - 4, gridSize - 4);
                    }
                });
                
                // Отрисовка еды
                ctx.fillStyle = '#ef4444';
                ctx.beginPath();
                ctx.arc(
                    food.x * gridSize + gridSize / 2, 
                    food.y * gridSize + gridSize / 2, 
                    gridSize / 2, 
                    0, 
                    Math.PI * 2
                );
                ctx.fill();
                
                // Добавление эффекта яблока
                ctx.fillStyle = '#7f1d1d';
                ctx.beginPath();
                ctx.arc(
                    food.x * gridSize + gridSize / 2 - 3, 
                    food.y * gridSize + gridSize / 2 - 5, 
                    2, 
                    0, 
                    Math.PI * 2
                );
                ctx.fill();
                
                // Добавление листика к яблоку
                ctx.fillStyle = '#166534';
                ctx.beginPath();
                ctx.moveTo(food.x * gridSize + gridSize / 2, food.y * gridSize + gridSize / 2 - 8);
                ctx.lineTo(food.x * gridSize + gridSize / 2 + 5, food.y * gridSize + gridSize / 2 - 12);
                ctx.lineTo(food.x * gridSize + gridSize / 2, food.y * gridSize + gridSize / 2 - 15);
                ctx.fill();
            }
            
            // Mouse/Touch controls
            let activePointer = null;
            let canvasRect = null;

            function handlePointerStart(e) {
                if (!gameRunning) return;
                
                if (e.type.includes('touch')) {
                    e.preventDefault();
                    activePointer = e.touches[0];
                } else {
                    activePointer = e;
                }
            }

            function handlePointerMove(e) {
                if (!gameRunning || !activePointer) return;
                
                const pointer = e.type.includes('touch') ? 
                    (Array.from(e.touches).find(t => t.identifier === activePointer.identifier) || e.changedTouches[0]) : 
                    e;
                
                if (!canvasRect) {
                    canvasRect = canvas.getBoundingClientRect();
                }

                const canvasX = pointer.clientX - canvasRect.left;
                const canvasY = pointer.clientY - canvasRect.top;
                
                const head = snake[0];
                const headX = head.x * gridSize + gridSize/2;
                const headY = head.y * gridSize + gridSize/2;
                
                const dx = canvasX - headX;
                const dy = canvasY - headY;
                
                if (Math.abs(dx) > Math.abs(dy)) {
                    if (dx > 0 && direction !== 'left') nextDirection = 'right';
                    else if (dx < 0 && direction !== 'right') nextDirection = 'left';
                } else {
                    if (dy > 0 && direction !== 'up') nextDirection = 'down';
                    else if (dy < 0 && direction !== 'down') nextDirection = 'up';
                }
            }

            function handlePointerEnd() {
                activePointer = null;
            }
            
            
            // Обновление счета
            function updateScore() {
                scoreDisplay.textContent = score;
            }
            
            // Окончание игры
            function gameOver() {
                gameRunning = false;
                clearInterval(gameLoop);
                
                // Показ экрана окончания игры
                finalScoreDisplay.textContent = score;
                gameOverScreen.classList.remove('opacity-0');
                gameOverScreen.classList.add('opacity-100');
                gameOverScreen.style.pointerEvents = 'all';
                
                // Обновление рекордов
                updateHighScores();
            }
            
            // Обновление таблицы рекордов
            function updateHighScores() {
                const storedScores = localStorage.getItem('snakeHighScores');
                let highScores = storedScores ? JSON.parse(storedScores) : [0, 0, 0];
                
                // Добавляем текущий счет
                highScores.push(score);
                
                // Сортируем по убыванию и оставляем топ-3
                highScores.sort((a, b) => b - a);
                highScores = highScores.slice(0, 3);
                
                // Сохраняем в localStorage
                localStorage.setItem('snakeHighScores', JSON.stringify(highScores));
                
                // Обновляем отображение
                const scoreItems = highScoresList.querySelectorAll('li');
                scoreItems.forEach((item, index) => {
                    const scoreSpan = item.querySelector('span:last-child');
                    scoreSpan.textContent = highScores[index] > 0 ? highScores[index] : '---';
                });
            }
            
            // Загрузка рекордов при запуске
            function loadHighScores() {
                const storedScores = localStorage.getItem('snakeHighScores');
                if (storedScores) {
                    const highScores = JSON.parse(storedScores);
                    const scoreItems = highScoresList.querySelectorAll('li');
                    
                    scoreItems.forEach((item, index) => {
                        const scoreSpan = item.querySelector('span:last-child');
                        scoreSpan.textContent = highScores[index] > 0 ? highScores[index] : '---';
                    });
                }
            }
            
            // Запуск игры
            function startGame() {
                initGame();
                welcomeScreen.classList.add('hidden');
                gameOverScreen.classList.remove('opacity-100');
                gameOverScreen.classList.add('opacity-0');
                gameOverScreen.style.pointerEvents = 'none';
                
                gameRunning = true;
                
                // Запускаем игровой цикл
                if (gameLoop) clearInterval(gameLoop);
                gameLoop = setInterval(runGame, gameSpeed);
            }
            
            // Назначение обработчиков событий
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('restart-btn').addEventListener('click', startGame);
            
            // Mouse and touch controls
            canvas.addEventListener('mousedown', handlePointerStart);
            canvas.addEventListener('mousemove', handlePointerMove);
            document.addEventListener('mouseup', handlePointerEnd);
            
            canvas.addEventListener('touchstart', handlePointerStart, {passive: false});
            canvas.addEventListener('touchmove', handlePointerMove, {passive: false});
            canvas.addEventListener('touchend', handlePointerEnd);
            
            // Загрузка данных при запуске
            initGame();
            loadHighScores();
            drawGame();
        });
    </script>
</body>
</html>